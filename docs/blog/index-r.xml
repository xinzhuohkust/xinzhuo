<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Xinzhuo Huang</title>
<link>https://xinzhuo.work/blog/index.html#category=R</link>
<atom:link href="https://xinzhuo.work/blog/index-r.xml" rel="self" type="application/rss+xml"/>
<description>Xinzhuo&#39;s Personal Website</description>
<generator>quarto-1.2.335</generator>
<lastBuildDate>Thu, 11 May 2023 22:47:50 GMT</lastBuildDate>
<item>
  <title>Sentence Level Sentiment Analysis</title>
  <dc:creator>Xinzhuo HUANG</dc:creator>
  <link>https://xinzhuo.work/blog/sentiment analysis/index.html</link>
  <description><![CDATA[ <style>
body {text-align: justify}
</style>
<p><img src="https://xinzhuo.work/blog/sentiment analysis/images/sentiment.png" class="img-fluid"></p>
<p>Text analysis enables the identification and extraction of sentiment information from text. By leveraging tools such as <code>asent</code>, <code>sentimentr</code>, and basic sentiment lexicons, it is possible to construct a sentiment classifier that can estimate whether the underlying sentiment of a given text is positive, negative, or neutral.</p>
<section id="pacakage-management" class="level1"><h1>Pacakage Management</h1>
<p>Using <code>pacman</code> to manage package dependencies.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/trinker/pacman">pacman</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dplyr</span>, <span class="va" style="color: #111111;">magrittr</span>, <span class="va" style="color: #111111;">furrr</span>, <span class="va" style="color: #111111;">purrr</span>, <span class="va" style="color: #111111;">DT</span>, <span class="va" style="color: #111111;">readr</span>, <span class="va" style="color: #111111;">stringr</span>, <span class="va" style="color: #111111;">furrr</span>, <span class="va" style="color: #111111;">purrr</span>, <span class="va" style="color: #111111;">sentimentr</span>, <span class="va" style="color: #111111;">tidyfst</span>, <span class="va" style="color: #111111;">tidyr</span>, <span class="va" style="color: #111111;">textclean</span>, <span class="va" style="color: #111111;">tidytext</span>, <span class="va" style="color: #111111;">tibble</span>, <span class="va" style="color: #111111;">kableExtra</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</details>
</div>
</section><section id="load-data" class="level1"><h1>Load Data</h1>
<p>Our demonstration data are sourced from a news dataset collected from Factiva, consisting of 500 observations. The “link” refers to the links of these news articles. These news articles have been translated into English and undergone thorough text cleaning. Please find the data <a href="https://drive.google.com/file/d/1JKj8rDatjionAYN1EhzFnSNBRNQkay0C/view" class="external" target="_blank">here.</a></p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">data</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">read_rds</span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"E:/OneDrive - HKUST Connect/SOSC/paper_with_jean/group_meeting/fifth/data_for_analysis_share.Rds"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;">glimpse</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">data</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 500
Columns: 2
$ link         &lt;chr&gt; "https://global.factiva.com/redir/default.aspx?P=sa&amp;an=AF…
$ cleaned_text &lt;chr&gt; "the head of the women tennis association says that he is…</code></pre>
</div>
</div>
</section><section id="using-asent" class="level1"><h1>Using asent</h1>
<p>To use <code>asent</code>, a Python package in R, you need <code>reticulate</code> package to integrate Python code in your R script. You can change your python interpreter here:</p>
<p><img src="https://xinzhuo.work/blog/sentiment analysis/images/python_in_R.png" class="img-fluid" width="550"></p>
<section id="install-python-packages" class="level2"><h2 class="anchored" data-anchor-id="install-python-packages">install python packages:</h2>
<p>Call python in R.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;">reticulate</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://rstudio.github.io/reticulate/reference/use_python.html">use_python</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"C:\\Users\\xhuangcb\\anaconda3\\envs\\pytorch_gpu\\python.exe"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># call python in R</span></span></code></pre></div>
</details>
</div>
<p>Then:</p>
<div class="cell">
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;"> Tpying </th>
   <th style="text-align:left;"> To install </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:left;"> !pip install spacy </td>
   <td style="text-align:left;"> spacy </td>
  </tr>
<tr>
<td style="text-align:left;"> !pip install asent </td>
   <td style="text-align:left;"> asent </td>
  </tr>
<tr>
<td style="text-align:left;"> !pip install https://github.com/explosion/spacy-models/releases/download/en_core_web_lg-3.5.0/en_core_web_lg-3.5.0-py3-none-any.whl </td>
   <td style="text-align:left;"> pre-trained model </td>
  </tr>
</tbody>
</table>
</div>
</div>
<p><img src="https://xinzhuo.work/blog/sentiment analysis/images/callpythoninr.png" class="img-fluid" width="550"></p>
</section><section id="from-oop-to-fp" class="level2"><h2 class="anchored" data-anchor-id="from-oop-to-fp">from OOP to FP</h2>
<p>Python is an object-oriented programming (OOP) language, and it is possible to convert Python classes into functions in R, which mainly support functional programming (FP).</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">spacy</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">reticulate</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://rstudio.github.io/reticulate/reference/import.html">import</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"spacy"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># load spacy</span></span>
<span></span>
<span><span class="va" style="color: #111111;">asent</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">reticulate</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://rstudio.github.io/reticulate/reference/import.html">import</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"asent"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># load asent</span></span>
<span></span>
<span><span class="va" style="color: #111111;">nlp</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">spacy</span><span class="op" style="color: #5E5E5E;">$</span><span class="fu" style="color: #4758AB;">load</span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"en_core_web_lg"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># load pre-trained model</span></span>
<span></span>
<span><span class="va" style="color: #111111;">nlp</span><span class="op" style="color: #5E5E5E;">$</span><span class="fu" style="color: #4758AB;">add_pipe</span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"asent_en_v1"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># add asent pipe</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&lt;asent.component.Asent object at 0x00000188AE40D5E0&gt;</code></pre>
</div>
<details open=""><summary>Code</summary><div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">nlp_safe</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">possibly</span><span class="op" style="color: #5E5E5E;">(</span>.f <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">nlp</span>, otherwise <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"error!"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># error handling</span></span>
<span></span>
<span><span class="va" style="color: #111111;">get_polarity</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">nlp_safe</span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"sentiment"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">$</span><span class="fu" style="color: #4758AB;">get_extension</span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"polarity"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[[</span><span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span> <span class="co" style="color: #5E5E5E;"># load python function</span></span>
<span></span>
<span><span class="va" style="color: #111111;">get_sentiment_asent</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> \<span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">x</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span>    <span class="va" style="color: #111111;">result</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">nlp_safe</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">x</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;">get_polarity</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/capture.output.html">capture.output</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;">str_extract_all</span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"-?0\\.\\d+"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">result</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"neg"</span>, <span class="st" style="color: #20794D;">"neu"</span>, <span class="st" style="color: #20794D;">"pos"</span>, <span class="st" style="color: #20794D;">"compound"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span>    <span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">result</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="op" style="color: #5E5E5E;">}</span></span></code></pre></div>
</details>
</div>
<p>Try our function:</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;">get_sentiment_asent</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">data</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">cleaned_text</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>     neg      neu      pos compound 
  0.0440   0.6350   0.0710   0.1235 </code></pre>
</div>
</div>
<p>It is an analytical process of asent:</p>
<p><img src="https://xinzhuo.work/blog/sentiment analysis/images/result-01.png" class="img-fluid" width="680"></p>
</section></section><section id="using-sentimentr" class="level1"><h1>Using sentimentr</h1>
<p>Our function using <code>sentimentr</code>.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">get_sentences_safe</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">possibly</span><span class="op" style="color: #5E5E5E;">(</span>.f <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">get_sentences</span>, otherwise <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"error!"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># sentences cutter</span></span>
<span><span class="va" style="color: #111111;">sentiment_by_safe</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">possibly</span><span class="op" style="color: #5E5E5E;">(</span>.f <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">sentiment_by</span>, otherwise <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"error!"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># sentiment classifier</span></span>
<span><span class="va" style="color: #111111;">get_sentiemnt_sentimentr</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> \<span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">x</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span>    <span class="va" style="color: #111111;">x</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;">get_sentences_safe</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;">sentiment_by_safe</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="op" style="color: #5E5E5E;">}</span></span></code></pre></div>
</details>
</div>
<p>Try it:</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;">get_sentiemnt_sentimentr</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">data</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">cleaned_text</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   element_id    word_count            sd ave_sentiment 
    1.0000000   382.0000000     0.3115586     0.1770496 </code></pre>
</div>
</div>
</section><section id="word-level" class="level1"><h1>Word-level</h1>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">cal_sentiment</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> \<span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">x</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span>    <span class="va" style="color: #111111;">x</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">value</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;">pull</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">value</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">-&gt;</span> <span class="va" style="color: #111111;">neu</span></span>
<span></span>
<span>    <span class="va" style="color: #111111;">x</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">value</span> <span class="op" style="color: #5E5E5E;">&gt;</span> <span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;">pull</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">value</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">-&gt;</span> <span class="va" style="color: #111111;">pos</span></span>
<span></span>
<span>    <span class="va" style="color: #111111;">x</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">value</span> <span class="op" style="color: #5E5E5E;">&lt;</span> <span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;">pull</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">value</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">-&gt;</span> <span class="va" style="color: #111111;">neg</span></span>
<span>    <span class="va" style="color: #111111;">result</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">neu</span>, <span class="va" style="color: #111111;">pos</span>, <span class="va" style="color: #111111;">neg</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">result</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"neu"</span>, <span class="st" style="color: #20794D;">"pos"</span>, <span class="st" style="color: #20794D;">"neg"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span>    <span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">result</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="op" style="color: #5E5E5E;">}</span></span>
<span><span class="va" style="color: #111111;">get_sentiment_word</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> \<span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">x</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span>    <span class="va" style="color: #111111;">result</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">x</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;">tibble</span><span class="op" style="color: #5E5E5E;">(</span>text <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">.</span>, id <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;">unnest_tokens</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">word</span>, <span class="va" style="color: #111111;">text</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="va" style="color: #111111;">word</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu" style="color: #4758AB;">stopwords</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/stopwords/man/stopwords.html">stopwords</a></span><span class="op" style="color: #5E5E5E;">(</span>source <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"stopwords-iso"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;">left_join</span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;">get_sentiments</span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"afinn"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span> <span class="co" style="color: #5E5E5E;"># you can try different dict</span></span>
<span>        <span class="fu" style="color: #4758AB;">replace_na</span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;">(</span>value <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;">nest</span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">!</span><span class="va" style="color: #111111;">id</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;">mutate</span><span class="op" style="color: #5E5E5E;">(</span>sentiment <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;">map</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">data</span>, <span class="va" style="color: #111111;">cal_sentiment</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;">pull</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">sentiment</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span>    <span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">result</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="op" style="color: #5E5E5E;">}</span></span></code></pre></div>
</details>
</div>
<p>Try it:</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;">get_sentiment_word</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">data</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">cleaned_text</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>neu pos neg 
138  18 -12 </code></pre>
</div>
</div>
</section><section id="using-these-functions-in-loop" class="level1"><h1>Using these functions in loop</h1>
<p>You can use these function with <code>for</code> loop or just use <code>map</code>to apply a them to each element of a vector or list in tibble.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">data</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">data</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span></span>
<span>    <span class="fu" style="color: #4758AB;">mutate</span><span class="op" style="color: #5E5E5E;">(</span>sentiment_asent <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;">map</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">cleaned_text</span>, <span class="va" style="color: #111111;">get_sentiment_asent</span>, .progress <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">TRUE</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</details>
</div>


</section> ]]></description>
  <category>R</category>
  <category>Python</category>
  <category>Sentiment Analysis</category>
  <category>Reticulate</category>
  <guid>https://xinzhuo.work/blog/sentiment analysis/index.html</guid>
  <pubDate>Thu, 11 May 2023 22:47:50 GMT</pubDate>
  <media:content url="https://xinzhuo.work/blog/sentiment analysis/images/sentiment.png" medium="image" type="image/png" height="50" width="144"/>
</item>
</channel>
</rss>
